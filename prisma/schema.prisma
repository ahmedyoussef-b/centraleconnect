// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../src-tauri/ccpp.db"
}

model Component {
  id          String     @id
  name        String
  description String?
  type        String
  parameters  Parameter[]
  alarms      Alarm[]
  log_entries LogEntry[]
  documents   Document[]
}

model Parameter {
  id            Int     @id @default(autoincrement())
  component_id  String
  name          String
  unit          String?
  min_value     Float?
  max_value     Float?
  nominal_value Float?
  component     Component @relation(fields: [component_id], references: [id])
}

model Alarm {
  id           Int     @id @default(autoincrement())
  component_id String
  code         String
  description  String?
  severity     String // 'INFO', 'WARNING', 'CRITICAL'
  component    Component @relation(fields: [component_id], references: [id])

  @@unique([component_id, code])
}

model LogEntry {
  id           Int      @id @default(autoincrement())
  timestamp    DateTime @default(now())
  type         String // 'AUTO', 'MANUAL', 'DOCUMENT_ADDED'
  source       String
  message      String
  component_id String?
  signature    String?
  component    Component? @relation(fields: [component_id], references: [id])
}

model Document {
  id           Int      @id @default(autoincrement())
  component_id String
  type         String // 'PHOTO_ID_PLATE', 'MANUAL_PAGE', 'P&ID_SNIPPET'
  description  String?
  image_data   String? // Base64 encoded image
  ocr_text     String?
  created_at   DateTime @default(now())
  component    Component @relation(fields: [component_id], references: [id])
}

model FunctionalNode {
  id                  Int          @id @default(autoincrement())
  external_id         String       @unique
  system              String
  subsystem           String
  document            String?
  tag                 String?
  type                String
  name                String
  description         String?
  location            String?
  coordinates         String? // Stored as JSON string
  linked_parameters   String? // Stored as JSON string
  svg_layer           String?
  fire_zone           String?
  status              String
  checksum            String
  created_at          DateTime
  updated_at          DateTime
  approved_by         String?
  approved_at         DateTime?
  annotations         Annotation[]
}

model Annotation {
  id                          Int      @id @default(autoincrement())
  functional_node_external_id String
  text                        String
  operator                    String
  timestamp                   DateTime @default(now())
  x_pos                       Float
  y_pos                       Float
  functional_node             FunctionalNode @relation(fields: [functional_node_external_id], references: [external_id])
}
